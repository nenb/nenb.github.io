Search.setIndex({"docnames": ["blog/arrow_ipc", "blog/fragile_tests", "blog/sqlite_integer_encoding", "index"], "filenames": ["blog/arrow_ipc.md", "blog/fragile_tests.md", "blog/sqlite_integer_encoding.md", "index.md"], "titles": ["Apache Arrow IPC", "Fragile Tests", "Trade-offs", "Articles"], "terms": {"til": [0, 3], "how": [0, 1, 3], "serial": [0, 2, 3], "data": [0, 3], "The": [0, 1, 2], "project": [0, 1, 2], "us": [0, 1, 2], "commun": 0, "columnar": [0, 2], "across": [0, 2], "process": [0, 2], "machin": [0, 2], "reli": [0, 1], "flatbuff": [0, 2], "schema": [0, 2], "other": [0, 1, 2], "metadata": [0, 2], "represent": 0, "transmit": 0, "actual": [0, 1, 2], "arrai": 0, "thi": [0, 1, 2], "describ": 0, "reason": [0, 1, 2], "detail": [0, 1, 2], "construct": 0, "valid": [0, 1], "It": [0, 1, 2], "i": [0, 1, 2], "base": [0, 2], "materi": [0, 2], "from": [0, 1, 2, 3], "offici": 0, "document": [0, 1], "defin": [0, 1, 2], "being": [0, 2], "compos": 0, "bit": [0, 2], "flag": 0, "serialis": 0, "pad": 0, "more": [0, 1, 2], "precis": 0, "structur": [0, 2], "accord": 0, "follow": [0, 2], "sequenc": 0, "definit": [0, 1], "ar": [0, 1, 2], "avail": [0, 2], "repositori": 0, "As": [0, 2], "octob": 0, "2023": 0, "relev": [0, 2], "fb": 0, "tensor": 0, "sparsetensor": 0, "These": [0, 2], "contain": [0, 2], "all": [0, 1, 2], "requir": [0, 1, 2], "can": [0, 1, 2], "extend": [0, 1], "were": [0, 2], "creat": [0, 1, 2], "wai": [0, 1, 2], "should": [0, 1], "remain": [0, 2], "backward": 0, "compat": 0, "perhap": [0, 2], "simplest": 0, "produc": [0, 2], "null": 0, "ha": [0, 1], "column": [0, 2], "name": [0, 1], "type": [0, 1, 2], "payload": 0, "look": [0, 2], "like": [0, 2], "onli": [0, 1, 2], "highlight": [0, 2], "part": [0, 2], "particularli": 0, "root": 0, "tabl": [0, 2], "vtabl": 0, "see": [0, 1, 2], "here": [0, 1, 2], "first": [0, 2], "8": [0, 2], "byte": [0, 2], "indic": [0, 1, 2], "start": [0, 2], "well": [0, 1, 2], "total": [0, 2], "size": [0, 2], "48": 0, "inform": 0, "been": [0, 1, 2], "deriv": 0, "29": 0, "import": [0, 1, 2], "subsequ": 0, "messagehead": 0, "30": 0, "version": [0, 1, 2], "To": [0, 1], "scratch": 0, "": [0, 1, 2], "necessari": 0, "compil": 0, "flatc": 0, "did": 0, "python": [0, 1], "reproduc": 0, "code": 0, "org": 0, "flatbuf": 0, "pyarrow": 0, "builder": 0, "1024": 0, "schemastartfieldsvector": 0, "0": [0, 2], "field": 0, "endvector": 0, "schemastart": 0, "schemaaddfield": 0, "schemaaddendian": 0, "schemaend": 0, "messagestart": 0, "messageaddhead": 0, "messageaddvers": 0, "4": 0, "messageaddheadertyp": 0, "1": 0, "messageend": 0, "finish": 0, "note": [0, 2], "two": [0, 1, 2], "paragraph": 0, "taken": 0, "directli": [0, 2], "present": 0, "come": [0, 1], "outlin": [0, 2], "abov": 0, "same": 0, "If": [0, 2], "ani": [0, 1], "dictionari": 0, "encod": [0, 3], "one": [0, 1], "dictionarybatch": 0, "includ": [0, 2], "recordbatch": 0, "mai": [0, 2], "interleav": 0, "befor": [0, 2], "kei": [0, 1], "k": 0, "record": [0, 2], "batch": 0, "x": 0, "delta": 0, "y": 0, "n": [0, 2], "eo": 0, "option": 0, "0xffffffff": 0, "0x00000000": 0, "when": [0, 1, 2], "reader": 0, "implement": [0, 1, 2], "read": [0, 1, 2], "after": [0, 1, 2], "each": [0, 1, 2], "next": 0, "determin": [0, 2], "both": [0, 2], "continu": [0, 1], "writer": 0, "signal": 0, "end": [0, 1, 2], "either": 0, "write": [0, 1, 2], "length": [0, 3], "close": [0, 1, 2], "interfac": [0, 1], "we": [0, 2], "recommend": 0, "extens": 0, "although": 0, "mani": [0, 1], "case": 0, "ever": 0, "store": [0, 2], "involv": [0, 1, 2], "seri": 0, "send": 0, "them": [0, 1, 2], "order": 0, "attempt": 0, "explain": 0, "singl": [0, 1, 2], "int32": 0, "valu": [0, 2], "whose": [0, 1], "my_column_nam": 0, "do": [0, 2], "have": [0, 1, 2], "similar": [0, 2], "begin": [0, 2], "need": [0, 1, 2], "extra": [0, 2], "match": [0, 1], "int": 0, "pa": 0, "intstart": 0, "intaddbitwidth": 0, "32": 0, "intaddissign": 0, "true": [0, 1, 2], "int_typ": 0, "intend": 0, "column_on": 0, "createstr": 0, "fieldstartchildrenvector": 0, "child": 0, "fieldstart": 0, "fieldaddchildren": 0, "fieldaddtyp": 0, "fieldaddnam": 0, "fieldaddtypetyp": 0, "2": 0, "fieldaddnul": 0, "array_field": 0, "fieldend": 0, "prependuoffsettrel": 0, "append": 0, "achiev": 0, "boundari": 0, "buffer": [0, 2], "fieldnod": 0, "record_batch": 0, "recordbatchstartnodesvector": 0, "createfieldnod": 0, "node": [0, 2], "recordbatchstartbuffersvector": 0, "createbuff": 0, "recordbatchstart": 0, "recordbatchaddlength": 0, "recordbatchaddbuff": 0, "recordbatchaddnod": 0, "recordbatchend": 0, "messageaddbodylength": 0, "3": 0, "effici": [0, 2], "larg": 0, "dataset": 0, "analyt": [0, 2], "tool": 0, "small": [0, 2], "chunk": 0, "servic": 0, "row": [0, 2], "orient": 0, "storag": [0, 2], "transpos": 0, "friendli": 0, "your": [0, 1, 2], "cpu": [0, 2], "l2": 0, "l3": 0, "cach": [0, 2], "ram": 0, "unexpect": 0, "allow": 0, "compress": 0, "lz4": 0, "zstd": 0, "necessarili": 0, "correct": [0, 1, 2], "sai": [0, 2], "believ": 0, "affect": 0, "zero": 0, "copi": [0, 1], "philosophi": 0, "underpin": 0, "much": [0, 1], "confirm": 0, "In": [0, 1, 2], "practic": 0, "am": 0, "sure": [0, 1], "often": [0, 1, 2], "three": [0, 1, 2], "synchron": 0, "between": [0, 2], "asynchron": 0, "persist": 0, "arbitrari": [0, 2], "must": 0, "doe": [0, 1, 2], "support": 0, "random": [0, 2], "access": 0, "fix": [0, 1, 2], "number": 0, "thu": 0, "veri": [0, 1, 2], "memori": [0, 2], "map": 0, "magic": 0, "string": 0, "arrow1": 0, "plu": 0, "what": [0, 1, 2], "ident": 0, "At": 0, "footer": 0, "redund": 0, "which": [0, 2], "offset": 0, "block": 0, "enabl": 0, "schemat": 0, "empti": 0, "some": [0, 1, 2, 3], "thing": 0, "keep": 0, "mind": [0, 2], "compar": [0, 1, 2], "parquet": [0, 2], "design": [0, 1, 2], "long": [0, 1, 2], "term": [0, 1], "archiv": 0, "purpos": 0, "mean": [0, 1, 2], "you": [0, 2], "todai": 0, "expect": [0, 2], "system": [0, 2], "thei": [0, 1, 2], "abl": 0, "5": 0, "year": 0, "10": [0, 2], "while": 0, "disk": [0, 2], "stabl": 0, "readabl": [0, 1], "futur": 0, "librari": [0, 1], "priorit": 0, "gener": [0, 2], "yet": 0, "rel": 0, "complex": 0, "decod": [0, 2], "becaus": [0, 1, 2], "smaller": [0, 2], "than": [0, 1, 2], "strategi": 0, "network": [0, 2], "slow": 0, "better": 0, "choic": [0, 2], "even": [0, 1, 2], "short": 0, "side": [0, 2], "inspir": [1, 3], "tweet": [1, 3], "hynek": [1, 3], "schlawack": [1, 3], "check": [1, 2], "our": 1, "make": [1, 2], "maintain": 1, "refactor": 1, "easier": 1, "There": [1, 2], "But": 1, "point": 1, "find": [1, 2], "myself": [1, 2], "back": [1, 2], "ll": 1, "probabl": 1, "get": [1, 2], "differ": [1, 2], "answer": 1, "question": 1, "depend": [1, 2], "m": 1, "work": [1, 2], "hear": 1, "lot": 1, "though": [1, 2], "go": 1, "adopt": 1, "loos": 1, "easili": [1, 2], "broken": 1, "fire": 1, "up": [1, 2], "world": [1, 2], "patch": 1, "decor": 1, "unittest": 1, "lead": 1, "awar": 1, "popular": 1, "less": [1, 2], "setup": 1, "phase": 1, "my": [1, 2], "experi": [1, 2], "usual": 1, "cost": [1, 2], "introduc": 1, "suit": 1, "talk": 1, "about": [1, 2], "difficult": [1, 2], "so": [1, 2], "terminologi": 1, "overload": 1, "martin": 1, "fowler": 1, "classic": 1, "articl": 1, "help": 1, "cut": [1, 2], "through": 1, "nois": 1, "identifi": 1, "approach": [1, 2], "By": 1, "its": [1, 2], "natur": 1, "coupl": 1, "far": [1, 2], "prepar": 1, "fixtur": 1, "simpler": 1, "non": [1, 2], "exist": 1, "clearli": [1, 2], "let": 1, "imagin": 1, "api": 1, "retriev": 1, "employe": 1, "job": 1, "compani": 1, "protocol": [1, 2], "newtyp": 1, "str": 1, "dict": [1, 2], "class": 1, "employeeapi": 1, "def": 1, "self": 1, "insert": 1, "none": 1, "delet": 1, "also": [1, 2], "helper": 1, "function": 1, "capitalise_employees_nam": 1, "A": [1, 2], "basic": 1, "might": [1, 2], "uncapitalised_employee_info": 1, "capitalised_employee_info": 1, "_uncapitalised_and_capitalis": 1, "privat": 1, "encapsul": 1, "busi": 1, "logic": [1, 2], "unimport": 1, "now": 1, "ask": 1, "product": 1, "run": [1, 2], "everi": 1, "dai": [1, 2], "where": [1, 2], "exactli": 1, "verifi": 1, "prefer": 1, "solut": 1, "fake": 1, "possibl": [1, 2], "gist": 1, "idea": [1, 2], "repres": [1, 2], "simplifi": 1, "origin": [1, 2], "object": 1, "act": 1, "authorit": 1, "return": 1, "fakeemployeeapi": 1, "__init__": 1, "_employe": 1, "updat": 1, "pop": 1, "readi": 1, "pytest": 1, "fake_api": 1, "john": 1, "sale": 1, "alic": 1, "legal": 1, "test_capitalise_employees_nam": 1, "assert": 1, "With": 1, "don": [1, 2], "t": [1, 2], "bother": 1, "dive": 1, "straight": 1, "mock": 1, "testemployeeapihelperfunct": 1, "testcas": 1, "autospec": 1, "mock_api": 1, "return_valu": 1, "assert_called_onc": 1, "assert_called_once_with": 1, "quicker": 1, "previou": 1, "tradeoff": 1, "time": [1, 2], "sever": 1, "incid": 1, "loss": 1, "method": [1, 2], "old_employee_info": 1, "new_employee_info": 1, "take": [1, 2], "advantag": 1, "improv": 1, "call": [1, 2], "error": 1, "rais": 1, "miss": 1, "straightforward": 1, "understand": 1, "just": 1, "addit": 1, "That": 1, "No": 1, "And": 1, "matter": 1, "written": 1, "modifi": 1, "confid": [1, 2], "wa": [1, 2], "For": [1, 2], "problemat": 1, "fail": 1, "old": [1, 2], "new": [1, 2], "accordingli": 1, "Of": 1, "cours": 1, "simpl": 1, "manag": [1, 2], "scale": 1, "codebas": 1, "develop": 1, "perfectli": 1, "unhappi": 1, "ultim": [1, 2], "ignor": 1, "softwar": 1, "trade": [1, 3], "off": [1, 3], "attract": 1, "initi": [1, 2], "closer": 1, "encourag": 1, "harm": 1, "instead": [1, 2], "eas": 1, "burden": 1, "mainten": 1, "healthi": [1, 2], "avoid": 1, "sqlite": [2, 3], "drawn": 2, "content": 2, "discuss": 2, "behind": 2, "program": 2, "recent": 2, "ve": 2, "decis": 2, "apach": [2, 3], "arrow": [2, 3], "flight": 2, "framework": 2, "file": 2, "format": 2, "found": 2, "interest": 2, "offer": 2, "almost": 2, "sent": 2, "over": 2, "wire": 2, "nativ": 2, "via": 2, "increas": 2, "reduc": 2, "opposit": 2, "varint": 2, "transfer": 2, "connect": 2, "interestingli": 2, "revers": 2, "cap": 2, "proto": 2, "successor": 2, "author": 2, "consid": 2, "longer": 2, "desir": 2, "own": 2, "wide": 2, "embed": 2, "devic": 2, "an": 2, "consider": 2, "howev": 2, "most": 2, "place": 2, "premium": 2, "rough": 2, "sort": 2, "warn": 2, "brief": 2, "somewhat": 2, "naiv": 2, "analysi": 2, "pleas": 2, "pinch": 2, "salt": 2, "adapt": 2, "variat": 2, "profil": 2, "websit": 2, "ten": 2, "million": 2, "rowid": 2, "randominteg": 2, "53": 2, "7": 2, "randomword": 2, "squalid": 2, "real": 2, "uniformli": 2, "distribut": 2, "select": 2, "empir": 2, "90": 2, "75": 2, "25": 2, "1000": 2, "word": 2, "usr": 2, "share": 2, "sampl": 2, "had": 2, "six": 2, "fairli": 2, "count": 2, "avg": 2, "table1": 2, "table2": 2, "63": 2, "mix": 2, "person": 2, "pre": 2, "popul": 2, "csv": 2, "still": 2, "pattern": 2, "occur": 2, "quit": 2, "frequent": 2, "me": 2, "databas": 2, "e": 2, "g": 2, "text": 2, "linux": 2, "perf": 2, "flamegraph": 2, "visualis": 2, "sqlite3": 2, "apt": 2, "packag": 2, "unfortun": 2, "soon": 2, "discov": 2, "symbol": 2, "strip": 2, "objdump": 2, "sym": 2, "limit": 2, "pull": 2, "latest": 2, "44": 2, "built": 2, "local": 2, "default": 2, "set": 2, "settl": 2, "gather": 2, "f": 2, "5000": 2, "graph": 2, "dwarf": 2, "o": 2, "bash": 2, "my_bash_script": 2, "unprivileg": 2, "user": 2, "made": 2, "plai": 2, "perf_event_paranoid": 2, "quickli": 2, "becam": 2, "appar": 2, "page": 2, "neglig": 2, "On": 2, "reflect": 2, "split": 2, "those": 2, "warm": 2, "account": 2, "sync": 2, "command": 2, "along": 2, "proc": 2, "sy": 2, "vm": 2, "drop_cach": 2, "clear": 2, "move": 2, "xread": 2, "further": 2, "95": 2, "interv": 2, "second": 2, "9": 2, "flame": 2, "overal": 2, "appear": 2, "dash": 2, "oval": 2, "region": 2, "attribut": 2, "stack": 2, "trace": 2, "left": 2, "hand": 2, "__libc_pread64": 2, "impact": 2, "load": 2, "right": 2, "__libc_start_call_main": 2, "translat": 2, "sql": 2, "statement": 2, "bytecod": 2, "virtual": 2, "cpython": 2, "presum": 2, "section": 2, "strack": 2, "sqlite3vdbeexec": 2, "relat": 2, "link": 2, "understood": 2, "sqlite3vdbeserialget": 2, "consist": 2, "unless": 2, "power": 2, "think": 2, "unlik": 2, "notic": 2, "sqlite3btreepayloads": 2, "larger": 2, "b": 2, "tree": 2, "travers": 2, "leaf": 2, "known": 2, "advanc": 2, "partial": 2, "exampl": 2, "know": 2, "whether": 2, "particular": 2, "without": 2, "inspect": 2, "perform": 2, "clean": 2, "complic": 2, "fact": 2, "vari": 2, "algorithm": 2, "itself": 2, "cleaner": 2, "15": 2, "main": 2, "direct": 2, "visibl": 2, "frequenc": 2, "too": 2, "coars": 2, "anoth": 2, "attach": 2, "again": 2, "rather": 2, "specif": 2, "everyth": 2, "slower": 2, "didn": 2, "explan": 2, "spend": 2, "earlier": 2, "sqlite3btreelast": 2, "ad": 2, "henc": 2, "locat": 2, "explicitli": 2, "driver": 2, "sole": 2, "caus": 2, "12": 2, "regularli": 2, "major": 2, "quick": 2, "benefit": 2, "roughli": 2, "95mb": 2, "184": 2, "mb": 2, "64": 2, "sign": 2, "would": 2, "occupi": 2, "160mb": 2, "assum": 2, "20": 2, "charact": 2, "layout": 2, "360mb": 2, "50": 2, "reduct": 2, "sophist": 2, "against": 2, "ubiquit": 2, "panda": 2, "show": 2, "uncompress": 2, "105mb": 2, "120mb": 2, "compactli": 2, "v": 2, "primarili": 2, "fast": 2, "onlin": 2, "transact": 2, "oltp": 2, "wherea": 2, "olap": 2, "primari": 2, "factor": 2, "speed": 2, "ratio": 2, "runtim": 2, "modest": 2, "potenti": 2, "save": 2, "decreas": 2, "surprisingli": 2, "given": 2, "focu": 2, "home": 2, "messag": 2, "cargo": 2, "cult": 2, "alwai": 2, "ipc": 3, "fragil": 3, "test": 3, "experiment": 3, "variabl": 3, "integ": 3}, "objects": {}, "objtypes": {}, "objnames": {}, "titleterms": {"apach": 0, "arrow": 0, "ipc": 0, "encapsul": 0, "binari": 0, "messag": 0, "format": 0, "stream": 0, "protocol": 0, "an": [0, 1], "exampl": [0, 1], "file": 0, "fragil": 1, "test": [1, 2], "why": 1, "do": 1, "we": 1, "state": 1, "verif": 1, "behaviour": 1, "inevit": 1, "code": 1, "chang": 1, "final": [1, 2], "thought": [1, 2], "trade": 2, "off": 2, "variabl": 2, "length": 2, "integ": 2, "encod": 2, "experiment": 2, "setup": 2, "data": 2, "case": 2, "tool": 2, "result": 2, "1": 2, "4": 2, "2": 2, "cold": 2, "3": 2, "5": 2, "6": 2, "compress": 2, "articl": 3}, "envversion": {"sphinx.domains.c": 2, "sphinx.domains.changeset": 1, "sphinx.domains.citation": 1, "sphinx.domains.cpp": 8, "sphinx.domains.index": 1, "sphinx.domains.javascript": 2, "sphinx.domains.math": 2, "sphinx.domains.python": 3, "sphinx.domains.rst": 2, "sphinx.domains.std": 2, "sphinx": 57}, "alltitles": {"Apache Arrow IPC": [[0, "apache-arrow-ipc"]], "Encapsulated Binary Message Format": [[0, "encapsulated-binary-message-format"]], "Streaming Protocol": [[0, "streaming-protocol"]], "An example": [[0, "an-example"], [1, "an-example"]], "File Format": [[0, "file-format"]], "Fragile Tests": [[1, "fragile-tests"]], "Why do we test?": [[1, "why-do-we-test"]], "Why do we not test?": [[1, "why-do-we-not-test"]], "State verification": [[1, "state-verification"], [1, "id1"]], "Behaviour verification": [[1, "behaviour-verification"], [1, "id2"]], "An inevitable code change": [[1, "an-inevitable-code-change"]], "Final thoughts": [[1, "final-thoughts"], [2, "final-thoughts"]], "Trade-offs": [[2, "trade-offs"]], "Variable-length integer encoding": [[2, "variable-length-integer-encoding"]], "Experimentation setup": [[2, "experimentation-setup"]], "Data": [[2, "data"]], "Test cases": [[2, "test-cases"]], "Tools": [[2, "tools"]], "Experimentation results": [[2, "experimentation-results"]], "Test cases 1 - 4": [[2, "test-cases-1-4"]], "Test case 2 (cold)": [[2, "test-case-2-cold"]], "Test case 3 (cold)": [[2, "test-case-3-cold"]], "Test cases 5 - 6": [[2, "test-cases-5-6"]], "Compression": [[2, "compression"]], "Articles": [[3, "articles"]]}, "indexentries": {}})